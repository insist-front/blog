(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{573:function(s,t,a){s.exports=a.p+"assets/img/hive-05.21cc5e30.jpg"},574:function(s,t,a){s.exports=a.p+"assets/img/hive-06.01f7accc.jpg"},667:function(s,t,a){"use strict";a.r(t);var e=a(9),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"hadoop压缩配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hadoop压缩配置"}},[s._v("#")]),s._v(" Hadoop压缩配置")]),s._v(" "),e("h3",{attrs:{id:"mr支持的压缩编码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mr支持的压缩编码"}},[s._v("#")]),s._v(" MR支持的压缩编码")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("压缩格式")]),s._v(" "),e("th",[s._v("算法")]),s._v(" "),e("th",[s._v("文件扩展名")]),s._v(" "),e("th",[s._v("是否可切分")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("DEFLATE")]),s._v(" "),e("td",[s._v("DEFLATE")]),s._v(" "),e("td",[s._v(".deflate")]),s._v(" "),e("td",[s._v("否")])]),s._v(" "),e("tr",[e("td",[s._v("Gzip")]),s._v(" "),e("td",[s._v("DEFLATE")]),s._v(" "),e("td",[s._v(".gz")]),s._v(" "),e("td",[s._v("否")])]),s._v(" "),e("tr",[e("td",[s._v("bzip2")]),s._v(" "),e("td",[s._v("bzip2")]),s._v(" "),e("td",[s._v(".bzip2")]),s._v(" "),e("td",[s._v("是")])]),s._v(" "),e("tr",[e("td",[s._v("LZO")]),s._v(" "),e("td",[s._v("LZO")]),s._v(" "),e("td",[s._v(".lzo")]),s._v(" "),e("td",[s._v("是")])]),s._v(" "),e("tr",[e("td",[s._v("Snappy")]),s._v(" "),e("td",[s._v("Snappy")]),s._v(" "),e("td",[s._v(".snappy")]),s._v(" "),e("td",[s._v("否")])])])]),s._v(" "),e("h3",{attrs:{id:"压缩参数配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#压缩参数配置"}},[s._v("#")]),s._v(" 压缩参数配置")]),s._v(" "),e("p",[s._v("要在 Hadoop 中启用压缩，可以配置如下参数（mapred-site.xml 文件中）：")]),s._v(" "),e("p",[e("img",{attrs:{src:a(573),alt:""}})]),s._v(" "),e("h1",{attrs:{id:"开启map输出阶段压缩-mr引擎"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开启map输出阶段压缩-mr引擎"}},[s._v("#")]),s._v(" 开启Map输出阶段压缩（MR引擎）")]),s._v(" "),e("p",[s._v("开启 map 输出阶段压缩可以减少 job 中 map 和 Reduce task 间数据传输量。具体配置如下：")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("开启 hive 中间传输数据压缩功能")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" hive.exec.compress.intermediate"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("开启 mapreduce 中 map 输出压缩功能")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" mapreduce.map.output.compress"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("设置 mapreduce 中 map 输出数据的压缩方式")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" mapreduce.map.output.compress.codec"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("org.apache.hadoop.io.compress.SnappyCodec"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("执行查询语句")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" count"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ename"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" name from emp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])])]),s._v(" "),e("h1",{attrs:{id:"开启reduce输出阶段压缩-mr引擎"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开启reduce输出阶段压缩-mr引擎"}},[s._v("#")]),s._v(" 开启Reduce输出阶段压缩（MR引擎）")]),s._v(" "),e("p",[s._v("当 Hive 将 输 出 写 入 到 表 中 时 ， 输出内容同样可以进行压缩。属性hive.exec.compress.output控制着这个功能。用户可能需要保持默认设置文件中的默认值false，这样默认的输出就是非压缩的纯文本文件了。用户可以通过在查询语句或执行脚本中设置这个值为 true，来开启输出结果压缩功能。")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("开启 hive 最终输出数据压缩功能")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" hive.exec.compress.output"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("开启 mapreduce 最终输出数据压缩")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" mapreduce.output.fileoutputformat.compress"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("设置 mapreduce 最终数据输出压缩方式")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" mapreduce.output.fileoutputformat.compress.codec "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" org.apache.hadoop.io.compress.SnappyCodec"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("设置 mapreduce 最终数据输出压缩为块压缩")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" mapreduce.output.fileoutputformat.compress.type"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("BLOCK"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])])]),s._v(" "),e("h1",{attrs:{id:"文件存储格式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#文件存储格式"}},[s._v("#")]),s._v(" 文件存储格式")]),s._v(" "),e("p",[e("strong",[s._v("Hive 支持的存储数据的格式主要有：TEXTFILE 、SEQUENCEFILE、ORC、PARQUET。")])]),s._v(" "),e("ol",[e("li",[s._v("列式存储和行式存储")]),s._v(" "),e("li",[s._v("TextFile格式")]),s._v(" "),e("li",[s._v("Orc格式")]),s._v(" "),e("li",[s._v("Parquet格式")])]),s._v(" "),e("h1",{attrs:{id:"测试存储和压缩"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试存储和压缩"}},[s._v("#")]),s._v(" 测试存储和压缩")]),s._v(" "),e("p",[e("strong",[s._v("ORC 存储方式的压缩：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(574),alt:""}})]),s._v(" "),e("p",[e("strong",[s._v("注意：所有关于 ORCFile 的参数都是在 HQL 语句的 TBLPROPERTIES 字段里面出现")])]),s._v(" "),e("ol",[e("li",[e("p",[s._v("创建一个ZLIB压缩的ORC存储方式")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" log_orc_zlib"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\ntrack_time string"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nurl string"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nsession_id string"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nreferer string"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nip string"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nend_user_id string"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\ncity_id string\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" format delimited "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fields")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("terminated")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\t'")]),s._v("\nstored "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" orc\ntblproperties"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"orc.compress"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ZLIB"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("创建一个SNAPPY压缩的ORC存储方式")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" log_orc_snappy"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\ntrack_time string"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nurl string"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nsession_id string"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    referer string"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nip string"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nend_user_id string"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\ncity_id string\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" format delimited "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fields")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("terminated")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\t'")]),s._v("\nstored "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" orc\ntblproperties"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"orc.compress"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SNAPPY"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])])])])])}),[],!1,null,null,null);t.default=n.exports}}]);